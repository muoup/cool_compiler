#!/bin/bash

input="5 5 5 5"
pass=0
fail=0
if [ "$#" -gt 0 ]; then
    input=$1
fi

cd restricted_testcases || exit
printf "Checking for correct outputs\n"

for file in *.cl; do
    printf "Running test: %s -- " "$file"
    cool --tac "$file"
    them_original=$(echo "$input" | cool "$file-tac")

    cool --type "$file"
    dune exec --profile=release cool "$file-type" 2> /dev/null
    our_out=$(echo "$input" | cool "$file-tac")

    if [ "$them_original" != "$our_out" ]; then
        echo "FAILED"
        fail=$((fail+1))
    else 
        echo "PASSED"
        pass=$((pass+1))
    fi
    rm ./*.cl-t*

done
cd ..
echo "Passed: $pass"
echo "Failed: $fail"